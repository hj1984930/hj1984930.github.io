---
layout: post
title: DataDomain清理过期备份释放空间
description: ""
modified: 2015-09-28
tags: [DataDomain, 释放空间, 备份, ]
image:
  feature: abstract-4.jpg

---

###DataDomain清理过期备份释放空间

使用Networker和DataDomain的备份方案，经常会遇到DD空间已满，无法备份的问题，手动删除以前没用的备份数据集，释放空间

####1. 登录DD查看备份占用情况

~~~bash
[root@ddbackup ~]# mminfo -m
 状态  卷                       已写入  (%)   到期       读取  装载      容量
       filepool.001              30 TB 100% 2016年06月25日 0 KB   9      0 KB
       index.001                886 GB 100% 2016年09月26日 0 KB  10      0 KB
       oraclepool.001            63 TB 100% 2016年06月19日 0 KB   9      0 KB
       sqlpool.001                0 KB   0%     undef    0 KB     9      0 KB
       VBA Volume 1               0 KB   0%     undef    0 KB     9      0 KB
       vmpool.001               374 TB 100% 2016年08月17日 10 TB 10      0 KB
~~~

####2. 查出oracle数据库1个月前的备份集

~~~bash
[root@ddbackup ~]# mminfo -avot -q "volume=oraclepool.001 , savetime < 1 months ago" -r ssid
2212281426
2195504223
2178727018
2161949806
2145172597
2111618176
2094840965
1289613467
1272836251
1172174771
870186198
853409006
836631790
819854577
803077397
786300188
769522975
719195354
702418138
685640926
668863710
652086727
635309512
618532318
601755104
584977895
568200682
534646279
517869067
31405446
14628306
4292818661
4276041521
4259264613
4242487410
4225710529
4208933378
4192156408
4175379497
4158602330
4141825114
4125048226
4108271029
4091494180
4074716992
4057940114
4041162925
4024386075
4007608859
3990831644
3974054599
3957277395
3940500184
3890170092
3873392949
3856615734
3839838521
3823061306
3806284382
3789507166
3772729952
3755952736
3739175767
3722398551
3705621412
3688844203
3672066990
3655289786
3621735361
3604958147
3554626988
3537849785
3521072569
3504295357
3487518156
3470740948
3453963735
3386859100
3403636316
3370081893
3353304677
3336527698
3319750485
3302973277
3286196066
3269418859
3235864439
3219087227
~~~

备份集太多了，一个一个手动删除太麻烦，把备份集信息保存到文件中

~~~bash
mminfo -avot -q "volume=oraclepool.001 , savetime < 1 months ago" -r ssid > /tmp/ssid_need_to_delete.log 2>&1
~~~

####3. 使用脚本批量删除

~~~bash
for x in `cat /tmp/ssid_need_to_delete.log`; do nsrmm -d -y -S $x; echo $x; done
~~~

####4. 删除VBA的备份集

~~~bash
mminfo -avot -q "client=vba1,  savetime < 2 months ago" -r ssid > /tmp/ssid_need_to_delete.log 2>&1
~~~
找出后同样使用nsrmm释放空间

####5. DD的空间默认是每周固定时间做Clean操作
只有当Clean操作完成之后，才会正真释放DD的存储空间，所以如果DD空间不够了，还需手动执行Clean操作释放空间

![Clean释放空间](/images/dd-clean.png)
